---
title: ğŸ˜¤ 7.springboot-AOP
tag:
  - SpringBoot
  - JavaWeb
recommend: 7
---

## 1. äº‹åŠ¡ç®¡ç†



äº‹åŠ¡çš„æ“ä½œä¸»è¦æœ‰ä¸‰æ­¥ï¼š

1. å¼€å¯äº‹åŠ¡ï¼ˆä¸€ç»„æ“ä½œå¼€å§‹å‰ï¼Œå¼€å¯äº‹åŠ¡ï¼‰ï¼šstart transaction / begin ;

2. æäº¤äº‹åŠ¡ï¼ˆè¿™ç»„æ“ä½œå…¨éƒ¨æˆåŠŸåï¼Œæäº¤äº‹åŠ¡ï¼‰ï¼šcommit ;

3. å›æ»šäº‹åŠ¡ï¼ˆä¸­é—´ä»»ä½•ä¸€ä¸ªæ“ä½œå‡ºç°å¼‚å¸¸ï¼Œå›æ»šäº‹åŠ¡ï¼‰ï¼šrollback ;

### 1.1 **Spring**äº‹åŠ¡ç®¡ç†

#### **Transactional**æ³¨è§£

> @Transactionalä½œç”¨ï¼šå°±æ˜¯åœ¨å½“å‰è¿™ä¸ªæ–¹æ³•æ‰§è¡Œå¼€å§‹ä¹‹å‰æ¥å¼€å¯äº‹åŠ¡ï¼Œæ–¹æ³•æ‰§è¡Œå®Œæ¯•ä¹‹åæäº¤äº‹åŠ¡ã€‚å¦‚æœåœ¨è¿™ä¸ªæ–¹æ³•æ‰§è¡Œçš„è¿‡ç¨‹å½“ä¸­å‡ºç°äº†å¼‚å¸¸ï¼Œå°±ä¼šè¿›è¡Œäº‹åŠ¡çš„å›æ»šæ“ä½œã€‚
>
> @Transactionalæ³¨è§£ï¼šæˆ‘ä»¬ä¸€èˆ¬ä¼šåœ¨ä¸šåŠ¡å±‚å½“ä¸­æ¥æ§åˆ¶äº‹åŠ¡ï¼Œå› ä¸ºåœ¨ä¸šåŠ¡å±‚å½“ä¸­ï¼Œä¸€ä¸ªä¸šåŠ¡åŠŸèƒ½å¯èƒ½ä¼šåŒ…å«å¤šä¸ªæ•°æ®è®¿é—®çš„æ“ä½œã€‚åœ¨ä¸šåŠ¡å±‚æ¥æ§åˆ¶äº‹åŠ¡ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†å¤šä¸ªæ•°æ®è®¿é—®æ“ä½œæ§åˆ¶åœ¨ä¸€ä¸ªäº‹åŠ¡èŒƒå›´å†…ã€‚

@Transactionalæ³¨è§£ä¹¦å†™ä½ç½®ï¼š

- æ–¹æ³•
  - å½“å‰æ–¹æ³•äº¤ç»™springè¿›è¡Œäº‹åŠ¡ç®¡ç†

- ç±»
  - å½“å‰ç±»ä¸­æ‰€æœ‰çš„æ–¹æ³•éƒ½äº¤ç”±springè¿›è¡Œäº‹åŠ¡ç®¡ç†

- æ¥å£
  - æ¥å£ä¸‹æ‰€æœ‰çš„å®ç°ç±»å½“ä¸­æ‰€æœ‰çš„æ–¹æ³•éƒ½äº¤ç»™spring è¿›è¡Œäº‹åŠ¡ç®¡ç†

> Demo

```java
@Slf4j
@Service
public class DeptServiceImpl implements DeptService {
  @Autowired
  private DeptMapper deptMapper;
  @Autowired
  private EmpMapper empMapper;
  @Override
  @Transactional //å½“å‰æ–¹æ³•æ·»åŠ äº†äº‹åŠ¡ç®¡ç†
  public void delete(Integer id){
    //æ ¹æ®éƒ¨é—¨idåˆ é™¤éƒ¨é—¨ä¿¡æ¯
    deptMapper.deleteById(id);
    //æ¨¡æ‹Ÿï¼šå¼‚å¸¸å‘ç”Ÿ
    int i = 1/0;
    //åˆ é™¤éƒ¨é—¨ä¸‹çš„æ‰€æœ‰å‘˜å·¥ä¿¡æ¯
    empMapper.deleteByDeptId(id); 
  }
}
```

#### äº‹ç‰©è¿›é˜¶

å‰é¢æˆ‘ä»¬é€šè¿‡springäº‹åŠ¡ç®¡ç†æ³¨è§£@Transactionalå·²ç»æ§åˆ¶äº†ä¸šåŠ¡å±‚æ–¹æ³•çš„äº‹åŠ¡ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬è¦æ¥è¯¦ç»†çš„ä»‹ç»ä¸€ä¸‹@Transactionaläº‹åŠ¡ç®¡ç†æ³¨è§£çš„ä½¿ç”¨ç»†èŠ‚ã€‚æˆ‘ä»¬è¿™é‡Œä¸»è¦ä»‹ç»@Transactionalæ³¨è§£å½“ä¸­çš„ä¸¤ä¸ªå¸¸è§çš„å±æ€§ï¼š

1. å¼‚å¸¸å›æ»šçš„å±æ€§ï¼šrollbackFor

2. äº‹åŠ¡ä¼ æ’­è¡Œä¸ºï¼špropagation

##### rollbackFor

> éœ€è¦æ³¨æ„çš„æ˜¯
>
> åªæœ‰æœ‰å‡ºç°RuntimeException(è¿è¡Œæ—¶å¼‚å¸¸)æ‰ä¼šå›æ»šäº‹åŠ¡ã€‚
>
> é€šè¿‡é…ç½® @Transactional(rollbackFor=Exception.class) å®ç°æ‰€æœ‰å¼‚å¸¸çš„å›æ»š

##### propagation

> å½“ A æ–¹æ³•å’Œ B æ–¹æ³•ä»–ä»¬è‡ªèº«éƒ½æœ‰è‡ªå·±çš„äº‹ç‰©çš„æ—¶å€™,å½“ A æ–¹æ³•è°ƒç”¨ Bæ–¹æ³•çš„æ—¶å€™,A æ–¹æ³•å‡ºç°å¤±è¯¯çš„å›æ»šå¦‚ä½•æ§åˆ¶è¿™ä¸¤ä¸ªäº‹ç‰©å‘¢

![image-20231118202721928](https://img.picgo.net/2023/11/18/image-202311182027219288e094ed7b6dbaf97.png)

required:

å°†ä¸¤ä¸ªäº‹ç‰©åˆå¹¶ä¸ºä¸€ä¸ªäº‹ç‰©,å½“å…¶ä¸­çš„ä¸€ä¸ªå‘ç”Ÿäº†äº‹ç‰©çš„å›æ»šè¡Œä¸º,ä¼šåŒæ—¶è¿›è¡Œå›æ»š

Propagation.REQUIRES_NEW ï¼šä¸è®ºæ˜¯å¦æœ‰äº‹åŠ¡ï¼Œéƒ½åˆ›å»ºæ–°äº‹åŠ¡ ï¼Œè¿è¡Œåœ¨ä¸€ä¸ªç‹¬ç«‹çš„äº‹

åŠ¡ä¸­ã€‚

> @Transactional(propagation = Propagation.REQUIRES_NEW)//äº‹åŠ¡ä¼ æ’­è¡Œä¸ºï¼šä¸è®ºæ˜¯å¦æœ‰äº‹åŠ¡ï¼Œéƒ½æ–°å»ºäº‹åŠ¡

## 2. AOP

### **2.1 AOP**æ¦‚è¿°

ä»€ä¹ˆæ˜¯AOPï¼Ÿ

â€‹	AOPè‹±æ–‡å…¨ç§°ï¼šAspect Oriented Programmingï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ã€é¢å‘æ–¹é¢ç¼–ç¨‹ï¼‰ï¼Œå…¶å®è¯´ç™½äº†ï¼Œé¢å‘åˆ‡é¢ç¼–ç¨‹å°±æ˜¯é¢å‘ç‰¹å®šæ–¹æ³•ç¼–ç¨‹ã€‚

AOPçš„ä½œç”¨ï¼šåœ¨ç¨‹åºè¿è¡ŒæœŸé—´åœ¨ä¸ä¿®æ”¹æºä»£ç çš„åŸºç¡€ä¸Šå¯¹å·²æœ‰æ–¹æ³•è¿›è¡Œå¢å¼ºï¼ˆæ— ä¾µå…¥æ€§: è§£è€¦ï¼‰

> ç®€å•çš„è¯´å°±æ˜¯æ–¹æ³•çš„ä»£ç†

> AOPçš„ä¼˜åŠ¿ï¼š
>
> 1. å‡å°‘é‡å¤ä»£ç 
>
> 2. æé«˜å¼€å‘æ•ˆç‡
>
> 3. ç»´æŠ¤æ–¹ä¾¿

### **2.2 AOP**å¿«é€Ÿå…¥é—¨**å®ç°æ­¥éª¤ï¼š**

1. å¯¼å…¥ä¾èµ–ï¼šåœ¨pom.xmlä¸­å¯¼å…¥AOPçš„ä¾èµ–

2. ç¼–å†™AOPç¨‹åºï¼šé’ˆå¯¹äºç‰¹å®šæ–¹æ³•æ ¹æ®ä¸šåŠ¡éœ€è¦è¿›è¡Œç¼–ç¨‹

```xml
<dependency>
  <groupId>org.springframework.boot</groupId>
  <artifactId>spring-boot-starter-aop</artifactId>
</dependency>
```



> Demo

#### AOPç¨‹åºï¼šTimeAspect

```java
@Component
@Aspect //å½“å‰ç±»ä¸ºåˆ‡é¢ç±»
@Slf4j
public class TimeAspect {
  @Around("execution(* com.itheima.service.*.*(..))")
  public Object recordTime(ProceedingJoinPoint pjp) throws
    Throwable {
    //è®°å½•æ–¹æ³•æ‰§è¡Œå¼€å§‹æ—¶é—´
    long begin = System.currentTimeMillis();
    //æ‰§è¡ŒåŸå§‹æ–¹æ³•
    Object result = pjp.proceed();
    //è®°å½•æ–¹æ³•æ‰§è¡Œç»“æŸæ—¶é—´
    long end = System.currentTimeMillis();
    //è®¡ç®—æ–¹æ³•æ‰§è¡Œè€—æ—¶
    log.info(pjp.getSignature()+"æ‰§è¡Œè€—æ—¶: {}æ¯«ç§’",end-begin);
    return result;
  }
}
```

### 2.3 AOPæ ¸å¿ƒæ¦‚å¿µ

#### è¿æ¥ç‚¹ï¼šJoinPointï¼Œ

å¯ä»¥è¢«AOPæ§åˆ¶çš„æ–¹æ³•ï¼ˆæš—å«æ–¹æ³•æ‰§è¡Œæ—¶çš„ç›¸å…³ä¿¡æ¯ï¼‰

è¿æ¥ç‚¹æŒ‡çš„æ˜¯å¯ä»¥è¢«aopæ§åˆ¶çš„æ–¹æ³•ã€‚ä¾‹å¦‚ï¼šå…¥é—¨ç¨‹åºå½“ä¸­æ‰€æœ‰çš„ä¸šåŠ¡æ–¹æ³•éƒ½æ˜¯å¯ä»¥è¢«aopæ§åˆ¶çš„

æ–¹æ³•ã€‚

#### é€šçŸ¥ï¼šAdviceï¼ŒæŒ‡å“ªäº›é‡å¤çš„é€»è¾‘ï¼Œä¹Ÿå°±æ˜¯å…±æ€§åŠŸèƒ½ï¼ˆæœ€ç»ˆä½“ç°ä¸ºä¸€ä¸ªæ–¹æ³•ï¼‰

åœ¨å…¥é—¨ç¨‹åºä¸­æ˜¯éœ€è¦ç»Ÿè®¡å„ä¸ªä¸šåŠ¡æ–¹æ³•çš„æ‰§è¡Œè€—æ—¶çš„ï¼Œæ­¤æ—¶æˆ‘ä»¬å°±éœ€è¦åœ¨è¿™äº›ä¸šåŠ¡æ–¹æ³•è¿è¡Œå¼€å§‹ä¹‹å‰ï¼Œå…ˆè®°å½•è¿™ä¸ªæ–¹æ³•è¿è¡Œçš„å¼€å§‹æ—¶é—´ï¼Œåœ¨æ¯ä¸€ä¸ªä¸šåŠ¡æ–¹æ³•è¿è¡Œç»“æŸçš„æ—¶å€™ï¼Œå†æ¥è®°å½•è¿™ä¸ªæ–¹æ³•è¿è¡Œçš„ç»“æŸæ—¶é—´ã€‚

ä½†æ˜¯åœ¨AOPé¢å‘åˆ‡é¢ç¼–ç¨‹å½“ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦å°†è¿™éƒ¨åˆ†é‡å¤çš„ä»£ç é€»è¾‘æŠ½å–å‡ºæ¥å•ç‹¬å®šä¹‰ã€‚æŠ½å–å‡ºæ¥çš„è¿™ä¸€éƒ¨åˆ†é‡å¤çš„é€»è¾‘ï¼Œä¹Ÿå°±æ˜¯å…±æ€§çš„åŠŸèƒ½ã€‚

####  **åˆ‡å…¥ç‚¹ï¼š**PointCutï¼ŒåŒ¹é…è¿æ¥ç‚¹çš„æ¡ä»¶ï¼Œé€šçŸ¥ä»…ä¼šåœ¨åˆ‡å…¥ç‚¹æ–¹æ³•æ‰§è¡Œæ—¶è¢«åº”ç”¨

åœ¨é€šçŸ¥å½“ä¸­ï¼Œæˆ‘ä»¬æ‰€å®šä¹‰çš„å…±æ€§åŠŸèƒ½åˆ°åº•è¦åº”ç”¨åœ¨å“ªäº›æ–¹æ³•ä¸Šï¼Ÿæ­¤æ—¶å°±æ¶‰åŠåˆ°äº†åˆ‡å…¥ç‚¹pointcutæ¦‚å¿µã€‚åˆ‡å…¥ç‚¹æŒ‡çš„æ˜¯åŒ¹é…è¿æ¥ç‚¹çš„æ¡ä»¶ã€‚é€šçŸ¥ä»…ä¼šåœ¨åˆ‡å…¥ç‚¹æ–¹æ³•è¿è¡Œæ—¶æ‰ä¼šè¢«åº”ç”¨ã€‚åœ¨aopçš„å¼€å‘å½“ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šé€šè¿‡ä¸€ä¸ªåˆ‡å…¥ç‚¹è¡¨è¾¾å¼æ¥æè¿°åˆ‡å…¥ç‚¹(åé¢ä¼šæœ‰è¯¦è§£)ã€‚

####  **åˆ‡é¢ï¼š**Aspectï¼Œæè¿°é€šçŸ¥ä¸åˆ‡å…¥ç‚¹çš„å¯¹åº”å…³ç³»ï¼ˆé€šçŸ¥+åˆ‡å…¥ç‚¹ï¼‰

å½“é€šçŸ¥å’Œåˆ‡å…¥ç‚¹ç»“åˆåœ¨ä¸€èµ·ï¼Œå°±å½¢æˆäº†ä¸€ä¸ªåˆ‡é¢ã€‚é€šè¿‡åˆ‡é¢å°±èƒ½å¤Ÿæè¿°å½“å‰aopç¨‹åºéœ€è¦é’ˆå¯¹äºå“ªä¸ªåŸå§‹æ–¹æ³•ï¼Œåœ¨ä»€ä¹ˆæ—¶å€™æ‰§è¡Œä»€ä¹ˆæ ·çš„æ“ä½œã€‚

####  **ç›®æ ‡å¯¹è±¡ï¼š**Targetï¼Œé€šçŸ¥æ‰€åº”ç”¨çš„å¯¹è±¡

ç›®æ ‡å¯¹è±¡æŒ‡çš„å°±æ˜¯é€šçŸ¥æ‰€åº”ç”¨çš„å¯¹è±¡ï¼Œæˆ‘ä»¬å°±ç§°ä¹‹ä¸ºç›®æ ‡å¯¹è±¡ã€‚



## 3. äº‹ç‰©è¿›é˜¶

AOPçš„åŸºç¡€çŸ¥è¯†å­¦ä¹ å®Œä¹‹åï¼Œä¸‹é¢æˆ‘ä»¬å¯¹AOPå½“ä¸­çš„å„ä¸ªç»†èŠ‚è¿›è¡Œè¯¦ç»†çš„å­¦ä¹ ã€‚ä¸»è¦åˆ†ä¸º4ä¸ªéƒ¨åˆ†ï¼š

1. é€šçŸ¥ç±»å‹

2. é€šçŸ¥é¡ºåº

3. åˆ‡å…¥ç‚¹è¡¨è¾¾å¼

4. è¿æ¥ç‚¹

### 3.1 é€šçŸ¥ç±»å‹

 @Aroundï¼šç¯ç»•é€šçŸ¥ï¼Œæ­¤æ³¨è§£æ ‡æ³¨çš„é€šçŸ¥æ–¹æ³•åœ¨ç›®æ ‡æ–¹æ³•å‰ã€åéƒ½è¢«æ‰§è¡Œ

@Beforeï¼šå‰ç½®é€šçŸ¥ï¼Œæ­¤æ³¨è§£æ ‡æ³¨çš„é€šçŸ¥æ–¹æ³•åœ¨ç›®æ ‡æ–¹æ³•å‰è¢«æ‰§è¡Œ

@After ï¼šåç½®é€šçŸ¥ï¼Œæ­¤æ³¨è§£æ ‡æ³¨çš„é€šçŸ¥æ–¹æ³•åœ¨ç›®æ ‡æ–¹æ³•åè¢«æ‰§è¡Œï¼Œæ— è®ºæ˜¯å¦æœ‰å¼‚å¸¸éƒ½ä¼šæ‰§è¡Œ

@AfterReturning ï¼š è¿”å›åé€šçŸ¥ï¼Œæ­¤æ³¨è§£æ ‡æ³¨çš„é€šçŸ¥æ–¹æ³•åœ¨ç›®æ ‡æ–¹æ³•åè¢«æ‰§è¡Œï¼Œæœ‰å¼‚å¸¸ä¸ä¼šæ‰§è¡Œ

@AfterThrowing ï¼š å¼‚å¸¸åé€šçŸ¥ï¼Œæ­¤æ³¨è§£æ ‡æ³¨çš„é€šçŸ¥æ–¹æ³•å‘ç”Ÿå¼‚å¸¸åæ‰§è¡Œ



```java
@Slf4j
@Component
@Aspect
public class MyAspect1 {
  //å‰ç½®é€šçŸ¥
  @Before("execution(* com.itheima.service.*.*(..))")
  public void before(JoinPoint joinPoint){
    log.info("before ...");
  }
  //ç¯ç»•é€šçŸ¥
  @Around("execution(* com.itheima.service.*.*(..))")
  public Object around(ProceedingJoinPoint proceedingJoinPoint)
    throws Throwable {
    log.info("around before ...");
    //è°ƒç”¨ç›®æ ‡å¯¹è±¡çš„åŸå§‹æ–¹æ³•æ‰§è¡Œ
    Object result = proceedingJoinPoint.proceed();
    //åŸå§‹æ–¹æ³•å¦‚æœæ‰§è¡Œæ—¶æœ‰å¼‚å¸¸ï¼Œç¯ç»•é€šçŸ¥ä¸­çš„åç½®ä»£ç ä¸ä¼šåœ¨æ‰§è¡Œäº†
    log.info("around after ...");
    return result;
  }
  //åç½®é€šçŸ¥
  @After("execution(* com.itheima.service.*.*(..))")
  public void after(JoinPoint joinPoint){
    log.info("after ...");
  }
  //è¿”å›åé€šçŸ¥ï¼ˆç¨‹åºåœ¨æ­£å¸¸æ‰§è¡Œçš„æƒ…å†µä¸‹ï¼Œä¼šæ‰§è¡Œçš„åç½®é€šçŸ¥ï¼‰
  @AfterReturning("execution(* com.itheima.service.*.*(..))")
  public void afterReturning(JoinPoint joinPoint){
    log.info("afterReturning ...");
  }
  //å¼‚å¸¸é€šçŸ¥ï¼ˆç¨‹åºåœ¨å‡ºç°å¼‚å¸¸çš„æƒ…å†µä¸‹ï¼Œæ‰§è¡Œçš„åç½®é€šçŸ¥ï¼‰
  @AfterThrowing("execution(* com.itheima.service.*.*(..))")
  public void afterThrowing(JoinPoint joinPoint){
    log.info("afterThrowing ...");
  }
}
```

### 3.2 æŠ½å–åˆ‡å…¥ç‚¹è¡¨è¾¾å¼

```java
//åˆ‡å…¥ç‚¹æ–¹æ³•ï¼ˆå…¬å…±çš„åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼‰
@Pointcut("execution(* com.itheima.service.*.*(..))")
private void pt(){}

// è°ƒç”¨

@Before("pt()")
```

### 3.3 **é€šçŸ¥é¡ºåº**

é»˜è®¤æŒ‰ç…§åˆ‡é¢ç±»çš„ç±»åå­—æ¯æ’åºï¼š

â€‹	ç›®æ ‡æ–¹æ³•å‰çš„é€šçŸ¥æ–¹æ³•ï¼šå­—æ¯æ’åé å‰çš„å…ˆæ‰§è¡Œ

â€‹	ç›®æ ‡æ–¹æ³•åçš„é€šçŸ¥æ–¹æ³•ï¼šå­—æ¯æ’åé å‰çš„åæ‰§è¡Œ

å¦‚ä½•æ§åˆ¶é¡ºåº:

1. ä¿®æ”¹åˆ‡é¢ç±»çš„ç±»åï¼ˆè¿™ç§æ–¹å¼éå¸¸ç¹çã€è€Œä¸”ä¸ä¾¿ç®¡ç†ï¼‰

2. ä½¿ç”¨Springæä¾›çš„@Orderæ³¨è§£

```java
@Slf4j
@Component
@Aspect
@Order(2) //åˆ‡é¢ç±»çš„æ‰§è¡Œé¡ºåºï¼ˆå‰ç½®é€šçŸ¥ï¼šæ•°å­—è¶Šå°å…ˆæ‰§è¡Œ; åç½®é€šçŸ¥ï¼šæ•°å­—è¶Šå°
è¶Šåæ‰§è¡Œï¼‰
  public class MyAspect2 {
    //å‰ç½®é€šçŸ¥
    @Before("execution(* com.itheima.service.*.*(..))")
    public void before(){
      log.info("MyAspect2 -> before ...");
    }
    //åç½®é€šçŸ¥
    @After("execution(* com.itheima.service.*.*(..))")
    public void after(){
      log.info("MyAspect2 -> after ...");
    }
  }
```

> é€šçŸ¥çš„æ‰§è¡Œé¡ºåºå¤§å®¶ä¸»è¦çŸ¥é“ä¸¤ç‚¹å³å¯ï¼š
>
> 1. ä¸åŒçš„åˆ‡é¢ç±»å½“ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹é€šçŸ¥çš„æ‰§è¡Œé¡ºåºæ˜¯ä¸åˆ‡é¢ç±»çš„ç±»åå­—æ¯æ’åºæ˜¯æœ‰å…³ç³»çš„
>
> 2. å¯ä»¥åœ¨åˆ‡é¢ç±»ä¸Šé¢åŠ ä¸Š@Orderæ³¨è§£ï¼Œæ¥æ§åˆ¶ä¸åŒçš„åˆ‡é¢ç±»é€šçŸ¥çš„æ‰§è¡Œé¡ºåº

### 3.4 **åˆ‡å…¥ç‚¹è¡¨è¾¾å¼**

#### 3.4.1 **execution**

executionä¸»è¦æ ¹æ®æ–¹æ³•çš„è¿”å›å€¼ã€åŒ…åã€ç±»åã€æ–¹æ³•åã€æ–¹æ³•å‚æ•°ç­‰ä¿¡æ¯æ¥åŒ¹é…ï¼Œè¯­æ³•ä¸ºï¼š

> execution(è®¿é—®ä¿®é¥°ç¬¦? è¿”å›å€¼ åŒ…å.ç±»å.?æ–¹æ³•å(æ–¹æ³•å‚æ•°) throws å¼‚å¸¸?) 

å…¶ä¸­å¸¦ ? çš„è¡¨ç¤ºå¯ä»¥çœç•¥çš„éƒ¨åˆ†

- è®¿é—®ä¿®é¥°ç¬¦ï¼šå¯çœç•¥ï¼ˆæ¯”å¦‚: publicã€protectedï¼‰

- åŒ…å.ç±»åï¼š å¯çœç•¥

- throws å¼‚å¸¸ï¼šå¯çœç•¥ï¼ˆæ³¨æ„æ˜¯æ–¹æ³•ä¸Šå£°æ˜æŠ›å‡ºçš„å¼‚å¸¸ï¼Œä¸æ˜¯å®é™…æŠ›å‡ºçš„å¼‚å¸¸ï¼‰

å¯ä»¥ä½¿ç”¨é€šé…ç¬¦æè¿°åˆ‡å…¥ç‚¹

\* ï¼šå•ä¸ªç‹¬ç«‹çš„ä»»æ„ç¬¦å·ï¼Œå¯ä»¥é€šé…ä»»æ„è¿”å›å€¼ã€åŒ…åã€ç±»åã€æ–¹æ³•åã€ä»»æ„ç±»å‹çš„ä¸€ä¸ªå‚æ•°ï¼Œä¹Ÿå¯ä»¥é€šé…åŒ…ã€ç±»ã€æ–¹æ³•åçš„ä¸€éƒ¨åˆ†

.. ï¼šå¤šä¸ªè¿ç»­çš„ä»»æ„ç¬¦å·ï¼Œå¯ä»¥é€šé…ä»»æ„å±‚çº§çš„åŒ…ï¼Œæˆ–ä»»æ„ç±»å‹ã€ä»»æ„ä¸ªæ•°çš„å‚æ•°



##### çœç•¥æ–¹æ³•çš„ä¿®é¥°ç¬¦å·

> `execution(voidcom.itheima.service.impl.DeptServiceImpl.delete(java.lang.Integer))`

##### ä½¿ç”¨ * ä»£æ›¿è¿”å›å€¼ç±»å‹

> `execution(*com.itheima.service.impl.DeptServiceImpl.delete(java.lang.Integer))`

##### ä½¿ç”¨ * ä»£æ›¿åŒ…åï¼ˆä¸€å±‚åŒ…ä½¿ç”¨ä¸€ä¸ª * ï¼‰

> `execution(*com.itheima.*.*.DeptServiceImpl.delete(java.lang.Integer))`

##### ä½¿ç”¨ .. çœç•¥åŒ…å

> `execution(* com..DeptServiceImpl.delete(java.lang.Integer))`

##### ä½¿ç”¨ * ä»£æ›¿ç±»å

> `execution(* com..*.delete(java.lang.Integer)) `

##### ä½¿ç”¨ * ä»£æ›¿æ–¹æ³•å

> `execution(* com..*.*(java.lang.Integer)) `

##### ä½¿ç”¨ * ä»£æ›¿å‚æ•°

> `execution(* com.itheima.service.impl.DeptServiceImpl.delete(*)) `

##### ä½¿ç”¨ .. çœç•¥å‚æ•°

> `execution(* com..*.*(..)) `

æ³¨æ„äº‹é¡¹ï¼š

æ ¹æ®ä¸šåŠ¡éœ€è¦ï¼Œå¯ä»¥ä½¿ç”¨ ä¸”ï¼ˆ&&ï¼‰ã€æˆ–ï¼ˆ||ï¼‰ã€éï¼ˆ!ï¼‰ æ¥ç»„åˆæ¯”è¾ƒå¤æ‚çš„åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ã€‚

> `execution(* com.itheima.service.DeptService.list(..)) ||`
>
> `execution(* com.itheima.service.DeptService.delete(..))`

#### 3.4.2 **@annotation**

1. ç¼–å†™è‡ªå®šä¹‰æ³¨è§£

2. åœ¨ä¸šåŠ¡ç±»è¦åšä¸ºè¿æ¥ç‚¹çš„æ–¹æ³•ä¸Šæ·»åŠ è‡ªå®šä¹‰æ³¨è§£

##### **è‡ªå®šä¹‰æ³¨è§£**ï¼šMyLog

```java
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface MyLog {
}
```

##### **ä¸šåŠ¡ç±»**ï¼šDeptServiceImpl 

```java
@MyLog //è‡ªå®šä¹‰æ³¨è§£ï¼ˆè¡¨ç¤ºï¼šå½“å‰æ–¹æ³•å±äºç›®æ ‡æ–¹æ³•ï¼‰
public List<Dept> list() {
  List<Dept> deptList = deptMapper.list();
  //æ¨¡æ‹Ÿå¼‚å¸¸
  //int num = 10/0;
  return deptList;
}
```

##### **åˆ‡é¢ç±»**

```java
//å‰ç½®é€šçŸ¥
@Before("@annotation(com.itheima.anno.MyLog)")
```

#### 3.4.3  **è¿æ¥ç‚¹**

åœ¨Springä¸­ç”¨JoinPointæŠ½è±¡äº†è¿æ¥ç‚¹ï¼Œç”¨å®ƒå¯ä»¥è·å¾—æ–¹æ³•æ‰§è¡Œæ—¶çš„ç›¸å…³ä¿¡æ¯ï¼Œå¦‚ç›®æ ‡ç±»åã€æ–¹æ³•åã€æ–¹æ³•å‚æ•°ç­‰ã€‚

- å¯¹äº@Aroundé€šçŸ¥ï¼Œè·å–è¿æ¥ç‚¹ä¿¡æ¯åªèƒ½ä½¿ç”¨ProceedingJoinPointç±»å‹

- å¯¹äºå…¶ä»–å››ç§é€šçŸ¥ï¼Œè·å–è¿æ¥ç‚¹ä¿¡æ¯åªèƒ½ä½¿ç”¨JoinPointï¼Œå®ƒæ˜¯ProceedingJoinPointçš„çˆ¶ç±»å‹

































