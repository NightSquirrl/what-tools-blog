---
title: ğŸª¤ vue-router
tag:
  - Vue
  - vue-router
---

# ğŸª¤ vue-router

## è·¯ç”±çš„ç›¸å…³çŸ¥è¯†ç‚¹

### å‰ç«¯è·¯ç”±

> å‰ç«¯è·¯ç”±æ˜¯åæ¥å‘å±•åˆ°SPAï¼ˆå•é¡µåº”ç”¨ï¼‰æ—¶æ‰å‡ºç°çš„æ¦‚å¿µã€‚ SPA å°±æ˜¯ä¸€ä¸ªWEBé¡¹ç›®åªæœ‰ä¸€ä¸ª HTML é¡µé¢ï¼Œä¸€æ—¦é¡µé¢åŠ è½½å®Œæˆï¼ŒSPA ä¸ä¼šå› ä¸ºç”¨æˆ·çš„æ“ä½œè€Œè¿›è¡Œé¡µé¢çš„é‡æ–°åŠ è½½æˆ–è·³è½¬ã€‚

å‰ç«¯è·¯ç”±åœ¨SPAé¡¹ç›®ä¸­æ˜¯å¿…ä¸å¯å°‘çš„ï¼Œé¡µé¢çš„è·³è½¬ã€åˆ·æ–°éƒ½ä¸è·¯ç”±æœ‰å…³ï¼Œé€šè¿‡ä¸åŒçš„urlæ˜¾ç¤ºç›¸åº”çš„é¡µé¢ã€‚

ä¼˜ç‚¹ï¼šå‰åç«¯çš„å½»åº•åˆ†ç¦»ï¼Œä¸åˆ·æ–°é¡µé¢ï¼Œç”¨æˆ·ä½“éªŒè¾ƒå¥½ï¼Œé¡µé¢æŒä¹…æ€§è¾ƒå¥½ã€‚

### åç«¯è·¯ç”±

å½“åœ¨åœ°å€æ åˆ‡æ¢ä¸åŒçš„urlæ—¶ï¼Œéƒ½ä¼šå‘æœåŠ¡å™¨å‘é€ä¸€ä¸ªè¯·æ±‚ï¼ŒæœåŠ¡å™¨æ¥æ”¶å¹¶å“åº”è¿™ä¸ªè¯·æ±‚ï¼Œåœ¨æœåŠ¡ç«¯æ‹¼æ¥å¥½htmlæ–‡ä»¶è¿”å›ç»™é¡µé¢æ¥å±•ç¤ºã€‚

ä¼˜ç‚¹ï¼šå‡è½»äº†å‰ç«¯çš„å‹åŠ›ï¼Œhtmléƒ½ç”±åç«¯æ‹¼æ¥ï¼›

ç¼ºç‚¹ï¼šä¾èµ–äºç½‘ç»œï¼Œç½‘é€Ÿæ…¢ï¼Œç”¨æˆ·ä½“éªŒå¾ˆå·®ï¼Œé¡¹ç›®æ¯”è¾ƒåºå¤§æ—¶ï¼ŒæœåŠ¡å™¨ç«¯å‹åŠ›è¾ƒå¤§ï¼Œ

ä¸èƒ½åœ¨åœ°å€æ è¾“å…¥æŒ‡å®šçš„urlè®¿é—®ç›¸åº”çš„æ¨¡å—ï¼Œå‰åç«¯ä¸åˆ†ç¦»ã€‚

### è·¯ç”±æ¨¡å¼

#### hashæ¨¡å¼ï¼ˆå¯¹åº”HashHistoryï¼‰

* å‰ç«¯è·¯ç”±çš„è·¯å¾„ç”¨äº•å· # æ‹¼æ¥åœ¨çœŸå® url åé¢çš„æ¨¡å¼ï¼Œä½†æ˜¯ä¼šè¦†ç›–é”šç‚¹å®šä½å…ƒç´ çš„åŠŸèƒ½ï¼Œé€šè¿‡ç›‘å¬ URL çš„å“ˆå¸Œéƒ¨åˆ†å˜åŒ–ï¼Œç›¸åº”åœ°æ›´æ–°é¡µé¢çš„å†…å®¹ã€‚

* å‰ç«¯è·¯ç”±çš„å¤„ç†å®Œå…¨åœ¨å®¢æˆ·ç«¯è¿›è¡Œï¼Œåœ¨è·¯ç”±å‘ç”Ÿå˜åŒ–æ—¶ï¼Œåªä¼šæ”¹å˜ URL ä¸­çš„å“ˆå¸Œéƒ¨åˆ†(äº•å· # åé¢çš„è·¯å¾„)ï¼Œä¸”ä¸ä¼šå‘æœåŠ¡å™¨å‘é€æ–°çš„è¯·æ±‚ï¼Œè€Œæ˜¯è§¦å‘ onhashchange äº‹ä»¶ã€‚

* hash åªæœ‰#ç¬¦å·ä¹‹å‰çš„å†…å®¹æ‰ä¼šåŒ…å«åœ¨è¯·æ±‚ä¸­è¢«å‘é€åˆ°åç«¯ï¼Œå¦‚æœ nginx æ²¡æœ‰åŒ¹é…å¾—åˆ°å½“å‰çš„ url ä¹Ÿæ²¡å…³ç³»ã€‚hash æ°¸è¿œä¸ä¼šæäº¤åˆ° server ç«¯ã€‚

* hashå€¼çš„æ”¹å˜ï¼Œéƒ½ä¼šåœ¨æµè§ˆå™¨çš„è®¿é—®å†å²ä¸­å¢åŠ ä¸€ä¸ªè®°å½•ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡æµè§ˆå™¨çš„å›é€€ã€å‰è¿›æŒ‰é’®æ§åˆ¶hashçš„åˆ‡æ¢ã€‚

* hash è·¯ç”±ä¸ä¼šé€ æˆ 404 é¡µé¢çš„é—®é¢˜ï¼Œå› ä¸ºæ‰€æœ‰è·¯ç”±ä¿¡æ¯éƒ½åœ¨å®¢æˆ·ç«¯è¿›è¡Œè§£æå’Œå¤„ç†ï¼ŒæœåŠ¡å™¨åªè´Ÿè´£æä¾›åº”ç”¨çš„åˆå§‹ HTML é¡µé¢å’Œé™æ€èµ„æºï¼Œä¸éœ€è¦å…³å¿ƒè·¯ç”±çš„åŒ¹é…é—®é¢˜ã€‚

```javascript
// onhashchageäº‹ä»¶ï¼Œå¯ä»¥åœ¨windowå¯¹è±¡ä¸Šç›‘å¬è¿™ä¸ªäº‹ä»¶
window.onhashchange = function(event){
  console.log(event.oldURL, event.newURL)
  let hash = location.hash.slice(1)
}

```

#### historyæ¨¡å¼ ï¼ˆå¯¹åº”HTML5Historyï¼‰

* æ˜¯ html5 æ–°æ¨å‡ºçš„åŠŸèƒ½ï¼Œæ¯” Hash url æ›´ç¾è§‚

* åœ¨ history æ¨¡å¼ä¸‹æµè§ˆå™¨åœ¨åˆ·æ–°é¡µé¢æ—¶ï¼Œä¼šæŒ‰ç…§è·¯å¾„å‘é€çœŸå®çš„èµ„æºè¯·æ±‚ã€‚å¦‚æœ nginx æ²¡æœ‰åŒ¹é…å¾—åˆ°å½“å‰çš„ url ï¼Œå°±ä¼šå‡ºç° 404 çš„é¡µé¢ã€‚

* åœ¨ä½¿ç”¨ history æ¨¡å¼æ—¶ï¼Œéœ€è¦**é€šè¿‡æœåŠ¡ç«¯æ”¯æŒå…è®¸åœ°å€å¯è®¿é—®**ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œå°±å¾ˆå®¹æ˜“å¯¼è‡´å‡ºç° 404 çš„å±€é¢ã€‚

* æ”¹å˜urlï¼š history æä¾›äº† pushState å’Œ replaceState ä¸¤ä¸ªæ–¹æ³•æ¥è®°å½•è·¯ç”±çŠ¶æ€ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•åªæ”¹å˜ URL ä¸ä¼šå¼•èµ·é¡µé¢åˆ·æ–°ã€‚

* ç›‘å¬urlå˜åŒ–ï¼šé€šè¿‡ onpopstate äº‹ä»¶ç›‘å¬historyå˜åŒ–ï¼Œåœ¨ç‚¹å‡»æµè§ˆå™¨çš„å‰è¿›æˆ–è€…åé€€åŠŸèƒ½æ—¶è§¦å‘ï¼Œåœ¨onpopstate äº‹ä»¶ä¸­æ ¹æ®çŠ¶æ€ä¿¡æ¯åŠ è½½å¯¹åº”çš„é¡µé¢å†…å®¹ã€‚

```javascript
history.replaceState({}, null, '/b') // æ›¿æ¢è·¯ç”±
history.pushState({}, null, '/a') // è·¯ç”±å‹æ ˆï¼Œè®°å½•æµè§ˆå™¨çš„å†å²æ ˆ ä¸åˆ·æ–°é¡µé¢
history.back() // è¿”å›
history.forward() // å‰è¿›
history.go(-2) // åé€€2æ¬¡

window.onpopstate = function(event) {
  // æ ¹æ®å½“å‰ URL åŠ è½½å¯¹åº”é¡µé¢
  loadPage(location.pathname); 
};

```

history.pushState ä¿®æ”¹æµè§ˆå™¨åœ°å€ï¼Œè€Œé¡µé¢çš„åŠ è½½æ˜¯é€šè¿‡ onpopstate äº‹ä»¶ç›‘å¬å®ç°ï¼ŒåŠ è½½å¯¹åº”çš„é¡µé¢å†…å®¹ï¼Œå®Œæˆé¡µé¢æ›´æ–°ã€‚



onpopstate äº‹ä»¶æ˜¯æµè§ˆå™¨å†å²å¯¼èˆªçš„æ ¸å¿ƒäº‹ä»¶,å®ƒæ ‡è¯†äº†é¡µé¢çŠ¶æ€çš„å˜åŒ–æ—¶æœºã€‚é€šè¿‡ç›‘å¬è¿™ä¸ªæ—¶æœº,æ ¹æ®æœ€æ–°çš„çŠ¶æ€ä¿¡æ¯æ›´æ–°é¡µé¢

å½“ä½¿ç”¨ history.pushState() æˆ– history.replaceState() æ–¹æ³•ä¿®æ”¹æµè§ˆå™¨çš„å†å²è®°å½•æ—¶ï¼Œä¸ä¼šç›´æ¥è§¦å‘ onpopstate äº‹ä»¶ã€‚

ä½†æ˜¯ï¼Œå¯ä»¥åœ¨è°ƒç”¨è¿™äº›æ–¹æ³•æ—¶å°†æ•°æ®å­˜å‚¨åœ¨å†å²è®°å½•æ¡ç›®çš„çŠ¶æ€å¯¹è±¡ä¸­ï¼Œ onpopstate äº‹ä»¶åœ¨å¤„ç†ç¨‹åºä¸­è®¿é—®è¯¥çŠ¶æ€å¯¹è±¡ã€‚è¿™æ ·ï¼Œå°±å¯ä»¥åœ¨ä¸è§¦å‘ onpopstate äº‹ä»¶çš„æƒ…å†µä¸‹æ›´æ–°é¡µé¢å†…å®¹ï¼Œå¹¶è·å–åˆ°ç›¸åº”çš„çŠ¶æ€å€¼ã€‚

#### history æ¨¡å¼ä¸‹ 404 é¡µé¢çš„å¤„ç†

åœ¨ history æ¨¡å¼ä¸‹ï¼Œæµè§ˆå™¨ä¼šå‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚ï¼ŒæœåŠ¡å™¨æ ¹æ®è¯·æ±‚çš„è·¯å¾„è¿›è¡ŒåŒ¹é…ï¼š

å¦‚æœæœåŠ¡å™¨æ— æ³•æ‰¾åˆ°ä¸è¯·æ±‚è·¯å¾„åŒ¹é…çš„èµ„æºæˆ–è·¯ç”±å¤„ç†å™¨ï¼ŒæœåŠ¡å™¨å¯ä»¥è¿”å› /404 è·¯ç”±ï¼Œè·³è½¬åˆ°é¡¹ç›®ä¸­é…ç½®çš„ 404 é¡µé¢ï¼ŒæŒ‡ç¤ºè¯¥è·¯å¾„æœªæ‰¾åˆ°ã€‚

å¯¹äºä½¿ç”¨å†å²è·¯ç”±æ¨¡å¼çš„å•é¡µåº”ç”¨ï¼ˆSPAï¼‰ï¼Œé€šå¸¸ä¼šåœ¨æœåŠ¡å™¨é…ç½®ä¸­æ·»åŠ ä¸€ä¸ªé€šé…ç¬¦è·¯ç”±ï¼Œå°†æ‰€æœ‰éé™æ€èµ„æºçš„è¯·æ±‚éƒ½é‡å®šå‘åˆ°ä¸»é¡µæˆ–ä¸€ä¸ªè‡ªå®šä¹‰çš„ 404 é¡µé¢ï¼Œä»¥ä¿è¯åœ¨å‰ç«¯å¤„ç†è·¯ç”±æ—¶ä¸ä¼šå‡ºç°çœŸæ­£çš„ 404 é”™è¯¯é¡µé¢ã€‚

åœ¨é¡¹ç›®ä¸­é…ç½®å¯¹åº”çš„  404 é¡µé¢:

```javascript
export const publicRoutes = [
  {
    path: '/404',
    component: () => import('src/views/404/index'),
  },
]

```

## Vue2 | vue-router@3

> å®‰è£…

```javascript
yarn add vue-router@3
```

> æ–°å»ºæ–‡ä»¶ src/router/index.js

```javascript
import Vue from 'vue';
import VueRouter from 'vue-router';
import Home from './views/Home.vue';
import About from './views/About.vue';

Vue.use(VueRouter);

const router = new VueRouter({
  mode: 'history',
  routes: [
    { path: '/', redirect: '/home' },  // è®¾ç½®æ ¹è·¯å¾„é‡å®šå‘åˆ° '/home'
    { path: '/home', component: Home },
    { path: '/about', component: About }
  ]
});

export default router;
```

åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œ`redirect` å­—æ®µç”¨äºæŒ‡å®šé‡å®šå‘çš„è·¯å¾„ã€‚

> åœ¨å…¥å£æ–‡ä»¶æŒ‚åœ¨è·¯ç”±

```javascript
import Vue from 'vue';
import App from './App.vue';
import router from './router';

new Vue({
  router,
  render: h => h(App)
}).$mount('#app');
```

```javascript
  this.$router.push('/about');
```



## Vue3 | vue-router@4

> å®‰è£…

```shell
yarn add vue-router@4
```

> æ–°å»ºæ–‡ä»¶ src/router/index.ts

```javascript
//1. å¯¼å…¥ç›¸å…³çš„ API
import { createRouter,createWebHistory,RouteRecordRaw } from "vue-router

// 2. å®šä¹‰è·¯ç”±ç»„ä»¶.
// ä¹Ÿå¯ä»¥ä»å…¶ä»–æ–‡ä»¶å¯¼å…¥
const routes:Array<RouterRecordRaw> = [
  {
    path:"/home/:id",
    name:"Home",
    component:()=>import('xxxx'),
    children:[
    ]
  },
   { path: '/', redirect: '/home' }, 
]

// 3. åˆ›å»ºè·¯ç”±å®ä¾‹å¹¶ä¼ é€’ `routes` é…ç½®
// ä½ å¯ä»¥åœ¨è¿™é‡Œè¾“å…¥æ›´å¤šçš„é…ç½®ï¼Œä½†æˆ‘ä»¬åœ¨è¿™é‡Œ
// æš‚æ—¶ä¿æŒç®€å•


// vue2 mode history vue3 createWebHistory
// history
//
    window.addEventListener('popstate',()=>{})
// vue2 mode hash vue3 createWebHasHistory // è·¯å¾„ä¼šå¤šä¸€ä¸ª#/
// location.hash
//window.addEventListener('hashchange',()=> {})
const router = createRouter({
  history:createWebbbHistory(),
  routes
})

export default router;
```

> åœ¨ vue çš„å…¥å£æ–‡ä»¶è¿›è¡ŒæŒ‚åœ¨æ³¨å†Œ

```javascript
// å¼•å…¥åˆšåˆšåˆ›å»ºçš„router

// 4. åˆ›å»ºå¹¶æŒ‚è½½æ ¹å®ä¾‹
const app = Vue.createApp({})
//ç¡®ä¿ _use_ è·¯ç”±å®ä¾‹ä½¿
//æ•´ä¸ªåº”ç”¨æ”¯æŒè·¯ç”±ã€‚
app.use(router)

app.mount('#app')
```

> å±•ç¤ºè·¯ç”±

```javascript
// 5. å±•ç¤º
<router-view></router-view>
```

> ç»„ä»¶å®ç°è·¯ç”±çš„è·³è½¬

```javascript
// 6. è·³è½¬
// ç»„ä»¶è·³è½¬
//replace ä¸ä¿ç•™å†å²è®°å½•
<router-link replace to=''>
// é»˜è®¤ push
<router-link :to='{name:"Home"}'>
```

> ç¼–ç¨‹å¼è·³è½¬

```javascript
//useRoute å–å‚æ•°
import { useRouter,useRoute} from "vue-router"
const router = useRouter()
router.push('')
router.push({
  name:"",
  query:"",
  params:""
})
router.replace('')
router.go(1)
router.back()
//å–å‚
const route = useRoute()
route.query.
route.params.
```

>  å…¨å±€å‰ç½®å®ˆå«

```javascript
router.beforeEach((to,from,next)=>{
  to.path
})

router.afterEach((to,from)=>{
  to.path
})
```

