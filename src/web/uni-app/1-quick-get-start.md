---
sticky: true
title: ğŸ˜¢ uni-app å¿«é€Ÿå…¥é—¨
tag:
  - uni-app
top: 8
recommend: 1
---

## 1. é¡¹ç›®çš„åˆ›å»ºæ–¹å¼

### 1.1 åˆ›å»º uni-app é¡¹ç›®æ–¹å¼

**uni-app æ”¯æŒä¸¤ç§æ–¹å¼åˆ›å»ºé¡¹ç›®ï¼š**

1. é€šè¿‡ HBuilderX åˆ›å»ºï¼ˆéœ€å®‰è£… HBuilderX ç¼–è¾‘å™¨ï¼‰
2. é€šè¿‡å‘½ä»¤è¡Œåˆ›å»ºï¼ˆéœ€å®‰è£… NodeJS ç¯å¢ƒï¼‰

## 2. HBuilderX åˆ›å»º uni-app é¡¹ç›®

1) é€šè¿‡å¯è§†åŒ–çš„ hbuilderx çš„ç•Œé¢åˆ›å»ºé¡¹ç›®

![uniapp_picture_2.609bc846](https://img.picgo.net/2023/11/24/uniapp_picture_2.609bc84658543df29435596a.png)

2. **å®‰è£… uni-app vue3 ç¼–è¯‘å™¨æ’ä»¶**
3. ç‚¹å‡»å·¥å…·->å®‰è£…æ’ä»¶,é€‰æ‹© uni-app(vue3)
4. æ‰“å¼€å¾®ä¿¡å°ç¨‹åºå¼€å‘è€…å·¥å…·,ç‚¹å‡»è®¾ç½®,ç‚¹å‡»å®‰å…¨,æ‰“å¼€æœåŠ¡ç«¯å£
5. åœ¨ hbuilderx ä¸­ç‚¹å‡»è¿è¡Œ,é€‰æ‹©å¾®ä¿¡å¼€å‘è€…å·¥å…·
   1. ç„¶åå°±ä¼šåœ¨å¾®ä¿¡å°ç¨‹åºæ‰“å¼€,å¯ä»¥ç‚¹å‡»è¿è¡Œå®æ—¶æŸ¥çœ‹æˆ‘ä»¬çš„ç•Œé¢

## 3. å‘½ä»¤è¡Œåˆ›å»º uni-app é¡¹ç›®

**ä¼˜åŠ¿**

é€šè¿‡å‘½ä»¤è¡Œåˆ›å»º uni-app é¡¹ç›®ï¼Œ**ä¸å¿…ä¾èµ– HBuilderX**ï¼ŒTypeScript ç±»å‹æ”¯æŒå‹å¥½ã€‚

**å‘½ä»¤è¡Œåˆ›å»º** **uni-app** **é¡¹ç›®ï¼š**

vue3 + ts ç‰ˆ

### github

```bash
# é€šè¿‡ npx ä» github ä¸‹è½½
npx degit dcloudio/uni-preset-vue#vite-ts é¡¹ç›®åç§°
```

### å›½å†… gitee

```bash
# é€šè¿‡ git ä» gitee å…‹éš†ä¸‹è½½
git clone -b vite-ts https://gitee.com/dcloud/uni-preset-vue.git
```

> å¸¸è§é—®é¢˜
>
> - è¿è¡Œ `npx` å‘½ä»¤ä¸‹è½½å¤±è´¥ï¼Œè¯·å°è¯•æ¢æˆ**æ‰‹æœºçƒ­ç‚¹é‡è¯•**
> - æ¢æ‰‹æœºçƒ­ç‚¹ä¾æ—§å¤±è´¥ï¼Œè¯·å°è¯•ä»[å›½å†…å¤‡ç”¨åœ°å€ä¸‹è½½](https://gitee.com/dcloud/uni-preset-vue/tree/vite-ts/)
> - åœ¨ `manifest.json` æ–‡ä»¶æ·»åŠ  [å°ç¨‹åº AppID](https://mp.weixin.qq.com/) ç”¨äºçœŸæœºé¢„è§ˆ
> - è¿è¡Œ `npx` å‘½ä»¤éœ€ä¾èµ– NodeJS ç¯å¢ƒï¼Œ[NodeJS ä¸‹è½½åœ°å€](https://nodejs.org/zh-cn)
> - è¿è¡Œ `git` å‘½ä»¤éœ€ä¾èµ– Git ç¯å¢ƒï¼Œ[Git ä¸‹è½½åœ°å€](https://git-scm.com/download/)

## 4.  VS Code å¼€å‘ uni-app é¡¹ç›®

### ä¸ºä»€ä¹ˆé€‰æ‹© VS Codeï¼Ÿ

- VS Code å¯¹ **TS ç±»å‹æ”¯æŒå‹å¥½**ï¼Œå‰ç«¯å¼€å‘è€…**ä¸»æµçš„ç¼–è¾‘å™¨**
- HbuilderX å¯¹ TS ç±»å‹æ”¯æŒæš‚ä¸å®Œå–„ï¼ŒæœŸå¾…å®˜æ–¹å®Œå–„ ğŸ‘€

### ç”¨ VS Code å¼€å‘é…ç½®

é¡¹ç›®é‡‡ç”¨ Vue3 + TS å¼€å‘ uni-app é¡¹ç›®ï¼Œæ‰€ä»¥éœ€è¦åˆ†åˆ«å®‰è£… Vue3 + TS æ’ä»¶ å’Œ uni-app æ’ä»¶ã€‚

#### å®‰è£… Vue3 + TS æ’ä»¶

> æ³¨æ„äº‹é¡¹
>
> æ²¡å¼€å‘è¿‡ Vue3 + TS é¡¹ç›®çš„å°ä¼™ä¼´æ³¨æ„ï¼Œéœ€è¦å…ˆå®‰è£… Vue3 å’Œ TS çš„æ’ä»¶ï¼Œå¹¶å®Œæˆä»¥ä¸‹é…ç½® ğŸ‘‡
>
> - å®‰è£… [Vue Language Features (Volar)](https://marketplace.visualstudio.com/items?itemName=Vue.volar) ï¼šVue3 è¯­æ³•æç¤ºæ’ä»¶
> - å®‰è£… [TypeScript Vue Plugin (Volar)](https://marketplace.visualstudio.com/items?itemName=Vue.vscode-typescript-vue-plugin) ï¼šVue3 çš„ TS æ’ä»¶
> - **å·¥ä½œåŒºç¦ç”¨** Vetur æ’ä»¶(Vue2 æ’ä»¶å’Œ Vue3 æ’ä»¶å†²çª)
> - **å·¥ä½œåŒºç¦ç”¨** @builtin typescript æ’ä»¶ï¼ˆç¦ç”¨åè‡ªåŠ¨å¼€å¯ Vue3 çš„ TS æ‰˜ç®¡æ¨¡å¼ï¼‰
>
> [æŸ¥çœ‹ Vue3 å®˜æ–¹æ–‡æ¡£](https://cn.vuejs.org/guide/typescript/overview.html#ide-support)



![uniapp_vscode_setting.75574ba6](https://img.picgo.net/2023/11/24/uniapp_vscode_setting.75574ba64ddb340202c90793.png)

#### å®‰è£… uni-app æ’ä»¶

- ğŸ‘‰ å®‰è£… uni-app å¼€å‘æ’ä»¶
  - [uni-create-view](https://marketplace.visualstudio.com/items?itemName=mrmaoddxxaa.create-uniapp-view) ï¼šå¿«é€Ÿåˆ›å»º uni-app é¡µé¢
  - [uni-helper](https://marketplace.visualstudio.com/items?itemName=uni-helper.uni-helper-vscode) ï¼šuni-app ä»£ç æç¤º
  - [uniapp å°ç¨‹åºæ‰©å±•](https://marketplace.visualstudio.com/items?itemName=evils.uniapp-vscode) ï¼šé¼ æ ‡æ‚¬åœæŸ¥æ–‡æ¡£
- ğŸ‘‰ TS ç±»å‹æ ¡éªŒ
  - å®‰è£… **ç±»å‹å£°æ˜æ–‡ä»¶** `pnpm i -D miniprogram-api-typings @uni-helper/uni-app-types`
  - é…ç½® `tsconfig.json`
- ğŸ‘‰ JSON æ³¨é‡Šé—®é¢˜
  - è®¾ç½®æ–‡ä»¶å…³è”ï¼ŒæŠŠ `manifest.json` å’Œ `pages.json` è®¾ç½®ä¸º `jsonc`

`tsconfig.json` å‚è€ƒ

```json
// tsconfig.json
{
  "extends": "@vue/tsconfig/tsconfig.json",
  "compilerOptions": {
    "sourceMap": true,
    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/*"]
    },
    "lib": ["esnext", "dom"],
    // ç±»å‹å£°æ˜æ–‡ä»¶
    "types": [
      "@dcloudio/types", // uni-app API ç±»å‹
      "miniprogram-api-typings", // åŸç”Ÿå¾®ä¿¡å°ç¨‹åºç±»å‹
      "@uni-helper/uni-app-types" // uni-app ç»„ä»¶ç±»å‹
    ]
  },
  // vue ç¼–è¯‘å™¨ç±»å‹ï¼Œæ ¡éªŒæ ‡ç­¾ç±»å‹
  "vueCompilerOptions": {
    // åŸé…ç½® `experimentalRuntimeMode` ç°è°ƒæ•´ä¸º `nativeTags`
    "nativeTags": ["block", "component", "template", "slot"], 
  },
  "include": ["src/**/*.ts", "src/**/*.d.ts", "src/**/*.tsx", "src/**/*.vue"]
}
```

**å·¥ä½œåŒºè®¾ç½®å‚è€ƒ**

```json
// .vscode/settings.json
{
  // åœ¨ä¿å­˜æ—¶æ ¼å¼åŒ–æ–‡ä»¶
  "editor.formatOnSave": true,
  // æ–‡ä»¶æ ¼å¼åŒ–é…ç½®
  "[json]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  },
  // é…ç½®è¯­è¨€çš„æ–‡ä»¶å…³è”
  "files.associations": {
    "pages.json": "jsonc", // pages.json å¯ä»¥å†™æ³¨é‡Š
    "manifest.json": "jsonc" // manifest.json å¯ä»¥å†™æ³¨é‡Š
  }
}
```

> ç‰ˆæœ¬å‡çº§
>
> - åŸä¾èµ– `@types/wechat-miniprogram` ç°è°ƒæ•´ä¸º [miniprogram-api-typings](https://github.com/wechat-miniprogram/api-typings)ã€‚
> - åŸé…ç½® `experimentalRuntimeMode` ç°è°ƒæ•´ä¸º `nativeTags`ã€‚

è¿™ä¸€æ­¥å¤„ç†å¾ˆå…³é”®ï¼Œå¦åˆ™ TS é¡¹ç›®æ— æ³•æ ¡éªŒç»„ä»¶å±æ€§ç±»å‹ã€‚



## 5. è§£è¯» pages.json

ç”¨äºé…ç½®é¡µé¢è·¯ç”±ã€å¯¼èˆªæ ã€tabBar ç­‰é¡µé¢ç±»ä¿¡æ¯

```json
{
  // é¡µé¢è·¯ç”±
  "pages": [
    {
      "path": "pages/index/index",
      // é¡µé¢æ ·å¼é…ç½®
      "style": {
        "navigationBarTitleText": "é¦–é¡µ"
      }
    },
    {
      "path": "pages/my/my",
      "style": {
        "navigationBarTitleText": "æˆ‘çš„"
      }
    }
  ],
  // å…¨å±€æ ·å¼é…ç½®
  "globalStyle": {
    "navigationBarTextStyle": "white",
    "navigationBarTitleText": "uni-app",
    "navigationBarBackgroundColor": "#27BA9B",
    "backgroundColor": "#F8F8F8"
  },
  // tabBar é…ç½®
  "tabBar": {
    "selectedColor": "#27BA9B",
    "list": [
      {
        "pagePath": "pages/index/index",
        "text": "é¦–é¡µ",
        "iconPath": "static/tabs/home_default.png",
        "selectedIconPath": "static/tabs/home_selected.png"
      },
      {
        "pagePath": "pages/my/my",
        "text": "æˆ‘çš„",
        "iconPath": "static/tabs/user_default.png",
        "selectedIconPath": "static/tabs/user_selected.png"
      }
    ]
  }
}
```

## 6. uni-app å’ŒåŸç”Ÿå°ç¨‹åºå¼€å‘åŒºåˆ«

### å¼€å‘åŒºåˆ«

uni-app é¡¹ç›®æ¯ä¸ªé¡µé¢æ˜¯ä¸€ä¸ª `.vue` æ–‡ä»¶ï¼Œæ•°æ®ç»‘å®šåŠäº‹ä»¶å¤„ç†åŒ `Vue.js` è§„èŒƒï¼š

1. å±æ€§ç»‘å®š `src="{ { url }}"` å‡çº§æˆ `:src="url"`
2. äº‹ä»¶ç»‘å®š `bindtap="eventName"` å‡çº§æˆ `@tap="eventName"`ï¼Œ**æ”¯æŒï¼ˆï¼‰ä¼ å‚**
3. æ”¯æŒ Vue å¸¸ç”¨**æŒ‡ä»¤** `v-for`ã€`v-if`ã€`v-show`ã€`v-model` ç­‰

### å…¶ä»–åŒºåˆ«è¡¥å……

1. è°ƒç”¨æ¥å£èƒ½åŠ›ï¼Œ**å»ºè®®å‰ç¼€** `wx` æ›¿æ¢ä¸º `uni` ï¼Œå…»æˆå¥½ä¹ æƒ¯ï¼Œ**æ”¯æŒå¤šç«¯å¼€å‘**ã€‚
2. `<style>` é¡µé¢æ ·å¼ä¸éœ€è¦å†™ `scoped`ï¼Œå°ç¨‹åºæ˜¯å¤šé¡µé¢åº”ç”¨ï¼Œ**é¡µé¢æ ·å¼è‡ªåŠ¨éš”ç¦»**ã€‚
3. **ç”Ÿå‘½å‘¨æœŸåˆ†ä¸‰éƒ¨åˆ†**ï¼šåº”ç”¨ç”Ÿå‘½å‘¨æœŸ(å°ç¨‹åº)ï¼Œé¡µé¢ç”Ÿå‘½å‘¨æœŸ(å°ç¨‹åº)ï¼Œç»„ä»¶ç”Ÿå‘½å‘¨æœŸ(Vue)



## 7. ç»„ä»¶åº“

å®‰è£… [uni-ui ç»„ä»¶åº“](https://uniapp.dcloud.net.cn/component/uniui/quickstart.html#npmå®‰è£…)

```bahs
pnpm i @dcloudio/uni-ui
```

é…ç½®è‡ªåŠ¨å¯¼å…¥ç»„ä»¶

```json
// pages.json
{
  // ç»„ä»¶è‡ªåŠ¨å¯¼å…¥
  "easycom": {
    "autoscan": true,
    "custom": {
+      // uni-ui è§„åˆ™å¦‚ä¸‹é…ç½®  
+      "^uni-(.*)": "@dcloudio/uni-ui/lib/uni-$1/uni-$1.vue" 
    }
  },
  "pages": [
    // â€¦çœç•¥
  ]
}
```

**å®‰è£…ç±»å‹å£°æ˜æ–‡ä»¶**

```bash
pnpm i -D @uni-helper/uni-ui-types
```

**é…ç½®ç±»å‹å£°æ˜æ–‡ä»¶**

```json
// tsconfig.json
{
  "compilerOptions": {
    // ...
    "types": [
      "@dcloudio/types", // uni-app API ç±»å‹
      "miniprogram-api-typings", // åŸç”Ÿå¾®ä¿¡å°ç¨‹åºç±»å‹
      "@uni-helper/uni-app-types", // uni-app ç»„ä»¶ç±»å‹
+      "@uni-helper/uni-ui-types" // uni-ui ç»„ä»¶ç±»å‹  
    ]
  },
  // vue ç¼–è¯‘å™¨ç±»å‹ï¼Œæ ¡éªŒæ ‡ç­¾ç±»å‹
  "vueCompilerOptions": {
    "nativeTags": ["block", "component", "template", "slot"]
  }
}
```

## 8. å°ç¨‹åºç«¯ Pinia æŒä¹…åŒ–

è¯´æ˜ï¼š`Pinia` ç”¨æ³•ä¸ `Vue3` é¡¹ç›®å®Œå…¨ä¸€è‡´ï¼Œ`uni-app` é¡¹ç›®ä»…éœ€è§£å†³**æŒä¹…åŒ–æ’ä»¶å…¼å®¹æ€§**é—®é¢˜ã€‚

### æŒä¹…åŒ–å­˜å‚¨æ’ä»¶

å®‰è£…æŒä¹…åŒ–å­˜å‚¨æ’ä»¶ï¼š [pinia-plugin-persistedstate](https://prazdevs.github.io/pinia-plugin-persistedstate/zh/guide/config.html#storage)

```sh
pnpm i pinia-plugin-persistedstate
```

æ’ä»¶é»˜è®¤ä½¿ç”¨ `localStorage` å®ç°æŒä¹…åŒ–ï¼Œå°ç¨‹åºç«¯ä¸å…¼å®¹ï¼Œéœ€è¦æ›¿æ¢æŒä¹…åŒ– APIã€‚

> Stores/modules/member.ts

```js
import { defineStore } from 'pinia'
import { ref } from 'vue'

// å®šä¹‰ Store
export const useMemberStore = defineStore(
  'member',
  () => {
    // ä¼šå‘˜ä¿¡æ¯
    const profile = ref<any>()

    // ä¿å­˜ä¼šå‘˜ä¿¡æ¯ï¼Œç™»å½•æ—¶ä½¿ç”¨
    const setProfile = (val: any) => {
      profile.value = val
    }

    // æ¸…ç†ä¼šå‘˜ä¿¡æ¯ï¼Œé€€å‡ºæ—¶ä½¿ç”¨
    const clearProfile = () => {
      profile.value = undefined
    }

    // è®°å¾— return
    return {
      profile,
      setProfile,
      clearProfile,
    }
  },
  // TODO: æŒä¹…åŒ–
  {
    persist: true,
  },
)
```

> Stores/index/ts

```js
import { createPinia } from 'pinia'
import persist from 'pinia-plugin-persistedstate'

// åˆ›å»º pinia å®ä¾‹
const pinia = createPinia()
// ä½¿ç”¨æŒä¹…åŒ–å­˜å‚¨æ’ä»¶
pinia.use(persist)

// é»˜è®¤å¯¼å‡ºï¼Œç»™ main.ts ä½¿ç”¨
export default pinia

// æ¨¡å—ç»Ÿä¸€å¯¼å‡º
export * from './modules/member'
```

> main.ts

```js
import { createSSRApp } from 'vue'
import pinia from './stores'

import App from './App.vue'
export function createApp() {
  const app = createSSRApp(App)

  app.use(pinia)
  return {
    app,
  }
}
```

### å¤šç«¯å…¼å®¹

**ç½‘é¡µç«¯æŒä¹…åŒ– API**

```js
// ç½‘é¡µç«¯API
localStorage.setItem()
localStorage.getItem()
```

**å¤šç«¯æŒä¹…åŒ– API**

```js
// å…¼å®¹å¤šç«¯API
uni.setStorageSync()
uni.getStorageSync()
```

**å‚è€ƒä»£ç **

```js

// stores/modules/member.ts
export const useMemberStore = defineStore(
  'member',
  () => {
    //â€¦çœç•¥
  },
  {
    // é…ç½®æŒä¹…åŒ–
    persist: {
      // è°ƒæ•´ä¸ºå…¼å®¹å¤šç«¯çš„API
      storage: {
        setItem(key, value) {
          uni.setStorageSync(key, value) 
        },
        getItem(key) {
          return uni.getStorageSync(key) 
        },
      },
    },
  },
)
```

## 9. uni.request è¯·æ±‚å°è£…

### è¯·æ±‚å’Œä¸Šä¼ æ–‡ä»¶æ‹¦æˆªå™¨

> å®ç°éœ€æ±‚
>
> 1. æ‹¼æ¥åŸºç¡€åœ°å€
> 2. è®¾ç½®è¶…æ—¶æ—¶é—´
> 3. æ·»åŠ è¯·æ±‚å¤´æ ‡è¯†
> 4. æ·»åŠ  token



å‚è€ƒä»£ç 

```js
// src/utils/http.ts

// è¯·æ±‚åŸºåœ°å€
const baseURL = 'https://pcapi-xiaotuxian-front-devtest.itheima.net'

// æ‹¦æˆªå™¨é…ç½®
const httpInterceptor = {
  // æ‹¦æˆªå‰è§¦å‘
  invoke(options: UniApp.RequestOptions) {
    // 1. é http å¼€å¤´éœ€æ‹¼æ¥åœ°å€
    if (!options.url.startsWith('http')) {
      options.url = baseURL + options.url
    }
    // 2. è¯·æ±‚è¶…æ—¶
    options.timeout = 10000
    // 3. æ·»åŠ å°ç¨‹åºç«¯è¯·æ±‚å¤´æ ‡è¯†
    options.header = {
      'source-client': 'miniapp',
      ...options.header,
    }
    // 4. æ·»åŠ  token è¯·æ±‚å¤´æ ‡è¯†
    const memberStore = useMemberStore()
    const token = memberStore.profile?.token
    if (token) {
      options.header.Authorization = token
    }
  },
}

// æ‹¦æˆª request è¯·æ±‚
uni.addInterceptor('request', httpInterceptor)
// æ‹¦æˆª uploadFile æ–‡ä»¶ä¸Šä¼ 
uni.addInterceptor('uploadFile', httpInterceptor)
```

> å¸¸è§é—®é¢˜
>
> **é—®:** ä¸ºä»€ä¹ˆç”¨æ‰‹æœºé¢„è§ˆæ²¡æœ‰æ•°æ®ï¼Ÿ
>
> **ç­”:** å¾®ä¿¡å°ç¨‹åºç«¯ï¼Œéœ€ç™»å½• [å¾®ä¿¡å…¬ä¼—å¹³å°](https://mp.weixin.qq.com/) é…ç½®ä»¥ä¸‹åœ°å€ä¸ºåˆæ³•åŸŸå ğŸ‘‡
>
> ```
> https://pcapi-xiaotuxian-front-devtest.itheima.net
> ```



### å°è£… Promise è¯·æ±‚å‡½æ•°

å®ç°éœ€æ±‚

1. è¿”å› Promise å¯¹è±¡ï¼Œç”¨äºå¤„ç†è¿”å›å€¼ç±»å‹
2. æˆåŠŸ resolve
   1. æå–æ•°æ®
   2. æ·»åŠ æ³›å‹
3. å¤±è´¥ reject
   1. 401 é”™è¯¯
   2. å…¶ä»–é”™è¯¯
   3. ç½‘ç»œé”™è¯¯

```js
/**
 * è¯·æ±‚å‡½æ•°
 * @param  UniApp.RequestOptions
 * @returns Promise
 *  1. è¿”å› Promise å¯¹è±¡ï¼Œç”¨äºå¤„ç†è¿”å›å€¼ç±»å‹
 *  2. è·å–æ•°æ®æˆåŠŸ
 *    2.1 æå–æ ¸å¿ƒæ•°æ® res.data
 *    2.2 æ·»åŠ ç±»å‹ï¼Œæ”¯æŒæ³›å‹
 *  3. è·å–æ•°æ®å¤±è´¥
 *    3.1 401é”™è¯¯  -> æ¸…ç†ç”¨æˆ·ä¿¡æ¯ï¼Œè·³è½¬åˆ°ç™»å½•é¡µ
 *    3.2 å…¶ä»–é”™è¯¯ -> æ ¹æ®åç«¯é”™è¯¯ä¿¡æ¯è½»æç¤º
 *    3.3 ç½‘ç»œé”™è¯¯ -> æç¤ºç”¨æˆ·æ¢ç½‘ç»œ
 */
type Data<T> = {
  code: string
  msg: string
  result: T
}
// 2.2 æ·»åŠ ç±»å‹ï¼Œæ”¯æŒæ³›å‹
export const http = <T>(options: UniApp.RequestOptions) => {
  // 1. è¿”å› Promise å¯¹è±¡
  return new Promise<Data<T>>((resolve, reject) => {
    uni.request({
      ...options,
      // å“åº”æˆåŠŸ
      success(res) {
        // çŠ¶æ€ç  2xxï¼Œå‚è€ƒ axios çš„è®¾è®¡
        if (res.statusCode >= 200 && res.statusCode < 300) {
          // 2.1 æå–æ ¸å¿ƒæ•°æ® res.data
          resolve(res.data as Data<T>)
        } else if (res.statusCode === 401) {
          // 401é”™è¯¯  -> æ¸…ç†ç”¨æˆ·ä¿¡æ¯ï¼Œè·³è½¬åˆ°ç™»å½•é¡µ
          const memberStore = useMemberStore()
          memberStore.clearProfile()
          uni.navigateTo({ url: '/pages/login/login' })
          reject(res)
        } else {
          // å…¶ä»–é”™è¯¯ -> æ ¹æ®åç«¯é”™è¯¯ä¿¡æ¯è½»æç¤º
          uni.showToast({
            icon: 'none',
            title: (res.data as Data<T>).msg || 'è¯·æ±‚é”™è¯¯',
          })
          reject(res)
        }
      },
      // å“åº”å¤±è´¥
      fail(err) {
        uni.showToast({
          icon: 'none',
          title: 'ç½‘ç»œé”™è¯¯ï¼Œæ¢ä¸ªç½‘ç»œè¯•è¯•',
        })
        reject(err)
      },
    })
  })
}
```



## 10. ç»Ÿä¸€ä»£ç é£æ ¼

- å®‰è£… `eslint` + `prettier`

```bash
pnpm i -D eslint prettier eslint-plugin-vue @vue/eslint-config-prettier @vue/eslint-config-typescript @rushstack/eslint-patch @vue/tsconfig
```

- æ–°å»º `.eslintrc.cjs` æ–‡ä»¶ï¼Œæ·»åŠ ä»¥ä¸‹ `eslint` é…ç½®

```js
/* eslint-env node */
require('@rushstack/eslint-patch/modern-module-resolution')

module.exports = {
  root: true,
  extends: [
    'plugin:vue/vue3-essential',
    'eslint:recommended',
    '@vue/eslint-config-typescript',
    '@vue/eslint-config-prettier',
  ],
  // å°ç¨‹åºå…¨å±€å˜é‡
  globals: {
    uni: true,
    wx: true,
    WechatMiniprogram: true,
    getCurrentPages: true,
    getApp: true,
    UniApp: true,
    UniHelper: true,
    App: true,
    Page: true,
    Component: true,
    AnyObject: true,
  },
  parserOptions: {
    ecmaVersion: 'latest',
  },
  rules: {
    'prettier/prettier': [
      'warn',
      {
        singleQuote: true,
        semi: false,
        printWidth: 100,
        trailingComma: 'all',
        endOfLine: 'auto',
      },
    ],
    'vue/multi-word-component-names': ['off'],
    'vue/no-setup-props-destructure': ['off'],
    'vue/no-deprecated-html-element-is': ['off'],
    '@typescript-eslint/no-unused-vars': ['off'],
  },
}
```

- é…ç½® `package.json`

```json
{
  "script": {
    // ... çœç•¥ ...
    "lint": "eslint . --ext .vue,.js,.ts --fix --ignore-path .gitignore"
  }
}
```

- è¿è¡Œ

```bash
pnpm lint
```

### Git å·¥ä½œæµè§„èŒƒ --- husky

- å®‰è£…å¹¶åˆå§‹åŒ– `husky`

```bash
pnpm dlx husky-init

npx husky-init
```

- å®‰è£… `lint-staged`

```bash
pnpm i -D lint-staged
```

- é…ç½® `package.json`

```json
{
  "script": {
    // ... çœç•¥ ...
  },
  "lint-staged": {
    "*.{vue,ts,js}": ["eslint --fix"]
  }
}
```

- ä¿®æ”¹ `.husky/pre-commit` æ–‡ä»¶

```bash
- npm test   
+ npm run lint-staged  
```

## 11. å®‰å…¨åŒºåŸŸ

ä¸åŒæ‰‹æœºçš„å®‰å…¨åŒºåŸŸä¸åŒï¼Œé€‚é…å®‰å…¨åŒºåŸŸèƒ½é˜²æ­¢é¡µé¢é‡è¦å†…å®¹è¢«é®æŒ¡ã€‚

å¯é€šè¿‡ `uni.getSystemInfoSync()` è·å–å±å¹•è¾¹ç•Œåˆ°å®‰å…¨åŒºçš„è·ç¦»ã€‚

![å®‰å…¨åŒºåŸŸ](https://img.picgo.net/2023/11/24/home_picture_2.89dbf50654a7fda1fc332c6b.png)

**è‡ªå®šä¹‰å¯¼èˆªé…ç½®**

```json
// src/pages.json
{
  "path": "pages/index/index",
  "style": {
    "navigationStyle": "custom", // éšè—é»˜è®¤å¯¼èˆª
    "navigationBarTextStyle": "white",
    "navigationBarTitleText": "é¦–é¡µ"
  }
}
```

**ç»„ä»¶å®‰å…¨åŒºé€‚é…**

```js
<!-- src/pages/index/componets/CustomNavbar.vue -->
<script>
// è·å–å±å¹•è¾¹ç•Œåˆ°å®‰å…¨åŒºåŸŸè·ç¦»
const { safeAreaInsets } = uni.getSystemInfoSync()
</script>

<template>
  <!-- é¡¶éƒ¨å ä½ -->
  <view class="navbar" :style="{ paddingTop: safeAreaInsets?.top + 'px' }">
    <!-- ...çœç•¥ -->
  </view>
</template>
```

## 12. çˆ¶ç»„ä»¶è°ƒç”¨å­ç»„ä»¶çš„æ–¹æ³•

å®ç°æµç¨‹

> çˆ¶ç»„ä»¶ä¼ é€’å‚æ•° ref="child"
>
> è·å–ç»„ä»¶çš„å®ä¾‹ç±»å‹ä¸»è¦æ˜¯ ts ä½¿ç”¨
>
> çˆ¶ç»„ä»¶è°ƒç”¨
>
> Child.value.å­æ–¹æ³•
>
> å­ç»„ä»¶æš´æ¼æ–¹æ³•
>
> 

```js

export type types = InstanceType<typeof  å­ç»„ä»¶>


child.value.æš´æ¼çš„æ–¹æ³•çš„ key

defineExpose({
  æš´éœ²æ–¹æ³•çš„ key:å…·ä½“çš„æš´æ¼æ–¹æ³•
})
```

## 13. ä¸‹æ‹‰åˆ·æ–°

åŸºäº `scroll-view` ç»„ä»¶å®ç°ä¸‹æ‹‰åˆ·æ–°ï¼Œéœ€è¦é€šè¿‡ä»¥ä¸‹æ–¹å¼æ¥å®ç°ä¸‹æ‹‰åˆ·æ–°çš„åŠŸèƒ½ã€‚

- é…ç½® `refresher-enabled` å±æ€§ï¼Œå¼€å¯ä¸‹æ‹‰åˆ·æ–°äº¤äº’
- ç›‘å¬ `@refresherrefresh` äº‹ä»¶ï¼Œåˆ¤æ–­ç”¨æˆ·æ˜¯å¦æ‰§è¡Œäº†ä¸‹æ‹‰æ“ä½œ
- é…ç½® `refresher-triggered` å±æ€§ï¼Œå…³é—­ä¸‹æ‹‰çŠ¶æ€

## 14. éª¨æ¶å±

åœ¨å¾®ä¿¡å°ç¨‹åºçš„æ¨¡æ‹Ÿå™¨ç•Œé¢ç‚¹å‡»é¡µé¢ä¿¡æ¯

![image-20231124213814562](https://img.picgo.net/2023/11/24/image-20231124213814562917856bb6661864e.png)

![image-20231124213829370](https://img.picgo.net/2023/11/24/image-202311242138293702604bbff0de03b52.png)

å°†ç”Ÿæˆçš„ä»£ç è¿›è¡Œä¿®æ”¹ vue å³å¯

## 15. WX è·å–ç™»å½•å‡­è¯

å‰ç«¯ï¼šè°ƒç”¨ [wx.login()](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/login/wx.login.html) æ¥å£è·å–ç™»å½•å‡­è¯ï¼ˆcodeï¼‰ã€‚

### è·å–æ‰‹æœºå·ç 

å‡ºäºå®‰å…¨é™åˆ¶ï¼Œå°ç¨‹åºã€è§„å®šã€‘æƒ³è·å–ç”¨æˆ·çš„æ‰‹æœºå·ï¼Œå¿…é¡»ç”±ç”¨æˆ·ä¸»åŠ¨ã€ç‚¹å‡»æŒ‰é’®ã€‘å¹¶ã€å…è®¸ç”³è¯·ã€‘æ‰å¯è·å–åŠ å¯†çš„æ‰‹æœºå·ä¿¡æ¯ã€‚

**å‰ç«¯**ï¼šæä¾› `open-type` æŒ‰é’®ï¼Œåœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­è·å–åŠ å¯†çš„æ‰‹æœºå·ä¿¡æ¯ã€‚

```js
<button class="button phone" open-type="getPhoneNumber" @getphonenumber="onGetphonenumber">
  <text class="icon icon-phone"></text>
æ‰‹æœºå·å¿«æ·ç™»å½•
  </button>
```

## 16. åˆ†åŒ…é¢„ä¸‹è½½

å½“ç”¨æˆ·è¿›å…¥ã€æˆ‘çš„ã€‘é¡µé¢æ—¶ï¼Œç”±æ¡†æ¶è‡ªåŠ¨é¢„ä¸‹è½½ã€ä¼šå‘˜æ¨¡å—ã€‘çš„åˆ†åŒ…ï¼Œæå‡è¿›å…¥åç»­åˆ†åŒ…é¡µé¢æ—¶çš„å¯åŠ¨é€Ÿåº¦ã€‚

### æ“ä½œæ–¹å¼

æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ä¸“é—¨ç”¨æ¥å­˜å‚¨åˆ†åŒ…çš„é¡µé¢

å¦‚æœå·²ç»é…ç½®äº†ä¹‹å‰ vscode çš„æ’ä»¶

å¯ä»¥å³é”®æ–‡ä»¶å¤¹é€‰æ‹©åˆ†åŒ…é¡µé¢

```json
// src/pages.json

{
  // ...çœç•¥
  // åˆ†åŒ…åŠ è½½è§„åˆ™
  "subPackages": [
    {
      // å­åŒ…çš„æ ¹ç›®å½•
      "root": "pagesMember",
      // é¡µé¢è·¯å¾„å’Œçª—å£è¡¨ç°
      "pages": [
        {
          "path": "settings/settings",
          "style": {
            "navigationBarTitleText": "è®¾ç½®"
          }
        }
      ]
    }
  ],
  // åˆ†åŒ…é¢„ä¸‹è½½è§„åˆ™
  "preloadRule": {
    "pages/my/my": {
      "network": "all", 
      "packages": ["pagesMember"] 
    }
  }
}
```

## 17. é¡¹ç›®æ‰“åŒ…

### æ ¸å¿ƒæ­¥éª¤

1. è¿è¡Œæ‰“åŒ…å‘½ä»¤ `pnpm build:mp-weixin`
2. é¢„è§ˆå’Œæµ‹è¯•ï¼Œå¾®ä¿¡å¼€å‘è€…å·¥å…·å¯¼å…¥ç”Ÿæˆçš„ `/dist/build/mp-weixin` ç›®å½•
3. ä¸Šä¼ å°ç¨‹åºä»£ç 
4. æäº¤å®¡æ ¸å’Œå‘å¸ƒ

### æ¡ä»¶ç¼–è¯‘

> å¸¸è§é—®é¢˜
>
> Qï¼šæŒ‰ç…§ uni-app è§„èŒƒå¼€å‘å¯ä¿è¯å¤šå¹³å°å…¼å®¹ï¼Œä½†æ¯ä¸ªå¹³å°æœ‰è‡ªå·±çš„ä¸€äº›ç‰¹æ€§ï¼Œè¯¥å¦‚ä½•å¤„ç†ï¼Ÿ
>
> Aï¼šé€šè¿‡ [æ¡ä»¶ç¼–è¯‘](https://uniapp.dcloud.net.cn/tutorial/platform.html#preprocessor)ï¼Œè®©ä»£ç æŒ‰æ¡ä»¶ç¼–è¯‘åˆ°æŒ‡å®šå¹³å°ã€‚

**ç½‘é¡µç«¯ä¸æ”¯æŒå¾®ä¿¡å¹³å°æˆæƒç™»å½•ç­‰åŠŸèƒ½**ï¼Œå¯é€šè¿‡ [æ¡ä»¶ç¼–è¯‘](https://uniapp.dcloud.net.cn/tutorial/platform.html#preprocessor)ï¼Œå®ç°ä¸åŒç«¯æ¸²æŸ“ä¸åŒçš„ç™»å½•ç•Œé¢ã€‚

### æ¡ä»¶ç¼–è¯‘è¯­æ³•

é€šè¿‡ç‰¹æ®Šæ³¨é‡Šï¼Œä»¥ **`#ifdef`** æˆ– **`#ifndef`** åŠ  **å¹³å°åç§°** å¼€å¤´ï¼Œä»¥ **`#endif`** ç»“å°¾ã€‚

å¤šå¹³å°ç¼–è¯‘ï¼š**`#ifdef H5 || MP-WEIXIN`** è¡¨ç¤ºåœ¨ **H5 ç«¯ æˆ– å¾®ä¿¡å°ç¨‹åºç«¯** ä»£ç ã€‚

æ¡ä»¶ç¼–è¯‘æ”¯æŒ: æ”¯æŒ .vue, .ts, .js, .scss, .css, pages.json ç­‰æ–‡ä»¶ã€‚

```vue
<script setup lang="ts">
// å¾®ä¿¡å¹³å°ç‰¹æœ‰APIï¼Œéœ€è¦æ¡ä»¶ç¼–è¯‘
// #ifdef MP-WEIXIN
wx.login()
wx.requestPayment()
// #endif
</script>

<template>
  <!-- å¾®ä¿¡å¼€å‘èƒ½åŠ›æŒ‰é’®ï¼Œéœ€è¦æ¡ä»¶ç¼–è¯‘ -->
  <!-- #ifdef MP-WEIXIN -->
  <button open-type="openSetting">æˆæƒç®¡ç†</button>
  <button open-type="feedback">é—®é¢˜åé¦ˆ</button>
  <button open-type="contact">è”ç³»æˆ‘ä»¬</button>
  <!-- #endif -->
</template>

<style>
/* å¦‚æœå‡ºç°æ ·å¼å…¼å®¹ï¼Œä¹Ÿå¯æ·»åŠ æ¡ä»¶ç¼–è¯‘ */
page {
  /* #ifdef H5 */
  background-color: pink;
  /* #endif */
}
</style>
```

> å¼€å‘æŠ€å·§
>
> å¯é€šè¿‡æœç´¢ `wx.` å’Œ `open-type` ç­‰å¹³å°å…³é”®è¯ï¼Œå¿«é€ŸæŸ¥æ‰¾éœ€è¦**å°ç¨‹åºç«¯**éœ€æ·»åŠ ç¼–è¯‘æ¨¡å¼çš„ä»£ç ã€‚

### æ‰“åŒ…ä¸º H5 ç«¯

æŠŠå½“å‰ uni-app é¡¹ç›®æ‰“åŒ…æˆç½‘é¡µ(H5)ç«¯ï¼Œå¹¶é…ç½®è·¯ç”±åŸºç¡€è·¯å¾„ã€‚

### æ ¸å¿ƒæ­¥éª¤

1. è¿è¡Œæ‰“åŒ…å‘½ä»¤ `pnpm build:h5`
2. é¢„è§ˆå’Œæµ‹è¯•ï¼Œä½¿ç”¨æµè§ˆå™¨æ‰“å¼€ `/dist/build/h5` ç›®å½•ä¸‹çš„ `index.html` æ–‡ä»¶
3. ç”±è¿ç»´éƒ¨ç½²åˆ°æœåŠ¡å™¨

### è·¯ç”±åŸºç¡€è·¯å¾„

é»˜è®¤çš„è·¯ç”±åŸºç¡€è·¯å¾„ä¸º `/` æ ¹è·¯å¾„ï¼Œéƒ¨åˆ†ç½‘ç«™å¹¶ä¸æ˜¯éƒ¨ç½²åˆ°æ ¹è·¯å¾„ï¼Œéœ€è¦æŒ‰è¿ç»´è¦æ±‚è°ƒæ•´ã€‚

```json

// manifest.json
{
  /* ç½‘é¡µç«¯ç‰¹æœ‰é…ç½® */
  "h5": {
    "router": {
      // åŸºç¡€è·¯å¾„ï¼š./ ä¸ºç›¸å¯¹è·¯å¾„
      "base": "./"
    }
  } /* å°ç¨‹åºç‰¹æœ‰ç›¸å…³ */,
  "mp-weixin": {
    // â€¦çœç•¥
  },
  "vueVersion": "3"
}
```

### æ‰“åŒ…ä¸º APP ç«¯

[App ç«¯](https://uniapp.dcloud.net.cn/tutorial/run/run-app.html) çš„æ‰“åŒ…ï¼Œé¢„è§ˆã€æµ‹è¯•ã€å‘è¡Œï¼Œä½¿ç”¨ `HBuilderX` å·¥å…·ã€‚
