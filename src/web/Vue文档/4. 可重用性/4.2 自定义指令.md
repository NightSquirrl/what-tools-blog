# 4.2 自定义指令

## 介绍

### 我们已经介绍过了两种 Vue 中重用逻辑的方式：组件和可组合函数。组件主要关注构建视图区块，而可组合函数关注于有状态的逻辑。自定义指令则主要是封装了可重用的对底层 DOM 访问的逻辑

### 一个自定义指令被定义为一个包含类似于组件的生命周期钩子的对象。钩子接收指令绑定到的元素

### 在  中，任何以 v 开头的 camelCase 格式的变量都会可以被用作一个自定义指令

### 如果不使用 ，自定义指令可以通过 directives 选项注册

### 常常也会将一个自定义指令注册到应用全局

- app.directive('focus', {/* ... */})

### 只有当所需功能只能通过直接 DOM 操作来实现时，才应该使用自定义指令。尽可能使用声明式的模板、使用内置指令例如 v-bind，因为这更高效、对服务端渲染更友好

## 指令钩子

### 一个指令的定义对象可以提供几种钩子函数 (都是可选的)

- created beforeMount mounted  beforeUpdate  updated  beforeUnmount  unmounted

### 钩子参数

- 指令的钩子会传递以下几种参数

	- el：指令绑定到的元素。这可以用于直接操作 DOM

	- binding：一个对象，包含以下属性

		- value  oldValue  arg  modifiers  instance  dir

	- vnode：代表绑定元素的底层 VNode

	- prevNode：之前的渲染中代表指令所绑定元素的 VNode。仅在 beforeUpdate 和 updated 钩子中可用

- 除了 el 外，你应该将这些参数都视为只读的，并一律不更改它们。若你需要在不同的钩子间共享信息，推荐方法是通过元素的 dataset attribute

## 简化形式

### 对于自定义指令来说，mounted 和 updated 需要相同的行为、又并不关心其他钩子的情况很常见。在这种时候，此时你可以将指令定义成一个下面这样的函数

<div v-color='color'></div>
app.directive(&#39;color&#39;, (el, binding) => {
  // 这会在 `mounted` 和 `updated` 时都调用
  el.style.color = binding.value
})
## 对象字面量

### 如果你的指令需要多个值，你可以向它传递一个 JavaScript 对象字面量。请记住，指令也可以接收任何合法的 JavaScript 表达式

## 在组件上使用

### 当在组件上使用自定义指令时，它会始终应用于组件的根节点，和透传 attributes 类似

### 如果组件可能含有多个根节点，指令不会起效、被忽略，还会抛出一个警告。和 attribute 不同，指令不可以通过 v-bind="$attrs" 来传递给一个不同的元素。总而言之，不推荐在组件上使用自定义指令


![4.2a4f62e382c5210f4.png](https://img.picgo.net/2024/02/10/4.2a4f62e382c5210f4.png)