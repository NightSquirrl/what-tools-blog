# 2.12 模板 ref

## 简介

### 虽然 Vue 的声明性渲染模型为你抽象了大部分对 DOM 的直接操作，但在某些情况下，我们仍然需要直接访问底层 DOM 元素。要实现这一点，我们可以使用特殊的 ref attribute，例如：

```vue
<li v-for='item in items'>
  {{ item.message }}
</li>
```
### ref 是一个特殊的 attribute，它允许我们在一个特定的 DOM 元素或子组件实例被挂载后，获得对它的直接引用

### 这可能很有用，比如说在组件挂载时编程式地聚焦到一个 input 元素上，或在一个元素上初始化一个第三方库

## 访问模板 ref

### 可以使用 v-for 来遍历一个对象的所有属性

### 为了通过组合式 API 获得该模板 ref，我们需要声明一个同名的 ref

```vue
<script setup>
import { ref, onMounted } from &#39;vue&#39;

// 声明一个 ref 来存放该元素的引用
// 必须和模板 ref 同名
const input = ref(null)

onMounted(() => {
  input.value.focus()
})
</script>

<template>
  <input ref='input' />
</template>
```
### 如果不使用 ，需确保从 setup() 返回 ref

### 注意，只可以在组件挂载后才能访问 ref。如果想在模板中的表达式上访问 input，在初次渲染时会是 null。这是因为在初次渲染前这个元素还压根不存在

## v-for 中的 ref

### v3.2.25+

### 当 ref 在 v-for 中使用时，相应的 ref 中包含的值是一个数组，它将在元素被挂载后填充

- 注意，ref 数组不能保证与源数组相同的顺序

## 函数型 ref

### 除了使用字符串值作名字，ref attribute 还可以绑定为一个函数，会在每次组件更新时都被调用。函数接受该元素引用作为第一个参数

`<input :ref='(el) => { /* 将 el 分配给 property 或 ref */ }'>`
### 如果你正在使用一个动态的 :ref 绑定，我们也可以传一个函数。当元素卸载时，这个 el 参数会是 null。你当然也可以使用一个方法而不是内联函数

## 组件上的 ref

### ref 也可以被用在一个子组件上。此时 ref 中引用的是组件实例

```vue
<script setup>
import { ref, onMounted } from &#39;vue&#39;
import Child from &#39;./Child.vue&#39;

const child = ref(null)

onMounted(() => {
  // child.value 是 <Child /> 组件的实例
})
</script>

<template>
  <Child ref='child' />
</template>
```
### 如果一个子组件使用的是选项式 API 或没有使用 ，被引用的组件实例和该子组件的 this 完全一致，这意味着父组件对子组件的每一个属性和方法都有完全的访问权

### 大多数情况下，你应该首先使用标准的 props 和 emit 接口来实现父子组件交互

### 有一个例外的情况，使用了  的组件时默认私有的：一个父组件无法访问到一个使用了  的子组件中的任何东西，除非子组件在其中通过 defineExpose 宏显式暴露


![2.12-ref21aed95fdb3a7a07.png](https://img.picgo.net/2024/02/10/2.12-ref21aed95fdb3a7a07.png)